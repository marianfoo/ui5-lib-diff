"use strict";sap.ui.define(["sap/ui/model/json/JSONModel","./BaseController","sap/ui/core/Fragment","sap/ui/Device","sap/ui/model/Sorter","sap/ui/model/Filter","sap/m/MessageToast"],function(e,t,i,s,n,o,a){"use strict";function r(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const l=r(t);const d=l.extend("de.marianzeis.ui5libdiff.controller.Whatsnew",{onInit:async function t(){this.getView().setBusyIndicatorDelay(0);this.getView().setBusy(true);this.getRouter().getRoute("whatsnew").attachEventOnce("patternMatched",this.onPatternMatchedOnce,this);const i=new e;this.whatsnewDataLoadled=i.loadData("./data/whatsnew.json");this.getView().setModel(i,"whatsnewData");const s=new e;this.selectDataLoaded=s.loadData("./data/selectVersionsSAPUI5.json");this.getView().setModel(s,"select");this._mViewSettingsDialogs={};this.getView().setModel(new e,"whatsnew");await Promise.all([this.whatsnewDataLoadled,this.selectDataLoaded]);this.getView().setBusy(false)},onNavBack:function e(){this.getRouter().navTo("main")},onPatternMatchedOnce:function e(){this.getRouter().getRoute("whatsnew").attachPatternMatched(this.onPatternMatched,this);this.getQueryParameter()},onPatternMatched:function e(){this.getQueryParameter()},getQueryParameter:async function e(){await Promise.all([this.whatsnewDataLoadled,this.selectDataLoaded]);const t=this.getView().getModel("select").getData();const i=new URLSearchParams(window.location.search);const s=i.get("versionFrom");const n=i.get("versionTo");if(s===null&&n===null)return;const o=e=>e&&t.some(t=>t.key===e||t.value===e);const r=[];if(!s){r.push("versionFrom should be added")}else if(!o(s)){r.push(`versionFrom ${s} is not valid`)}if(!n){r.push("versionTo should be added")}else if(!o(n)){r.push(`versionTo ${n} is not valid`)}if(r.length>0){a.show(r.join(" and "))}else{this.getView().byId("versionFromSelect").setSelectedKey(s);this.getView().byId("versionToSelect").setSelectedKey(n);await this.dataloadedPromise;this.handleVersionChange()}},copyLinkToClipboardWhatsnew:function e(t){this.copyLinkToClipboard(t)},handleVersionChange:function e(){this.getView().setBusyIndicatorDelay(0);this.getView().setBusy(true);this.updateURLParameters();let t=this.getView().byId("versionFromSelect").getSelectedKey();let i=this.getView().byId("versionToSelect").getSelectedKey();let s=this.compareVersions(t,i);if(t&&i){t=s.versionFrom;i=s.versionTo;const[e,n]=t.split(".").map(Number);const[o,a]=i.split(".").map(Number);const r=this.getView().getModel("whatsnewData").getData();const l=r.filter(t=>{const[i,s]=t.Version.split(".").map(Number);return(i>e||i===e&&s>=n)&&(i<o||i===o&&s<=a)});this.getView().getModel("whatsnew").setData(l)}this.getView().setBusy(false)},compareVersions:function e(t,i){const s=t.split(".").map(Number);const n=i.split(".").map(Number);for(let e=0;e<s.length;e++){if(s[e]>n[e]){return{versionFrom:i,versionTo:t}}else if(s[e]<n[e]){return{versionFrom:t,versionTo:i}}}return{versionFrom:t,versionTo:i}},handleSortButtonPressed:function e(){this.getViewSettingsDialog("de.marianzeis.ui5libdiff.fragment.SortDialog").then(function(e){e.open()})},handleFilterButtonPressed:function e(){this.getViewSettingsDialog("de.marianzeis.ui5libdiff.fragment.FilterDialog").then(function(e){e.open()})},handleSortDialogConfirm:function e(t){var i=this.byId("idProductsTable"),s=t.getParameters(),o=i.getBinding("items"),a,r,l=[];a=s.sortItem.getKey();r=s.sortDescending;l.push(new n(a,r));o.sort(l)},handleFilterDialogConfirm:function e(t){var i=this.byId("idProductsTable"),s=t.getParameters(),n=i.getBinding("items"),a=[];s.filterItems.forEach(function(e){var t=e.getKey().split("___"),i=t[0],s=t[1],n=t[2],r=t[3],l=new o(i,s,n,r);a.push(l)});n.filter(a);this.byId("vsdFilterBar").setVisible(a.length>0);this.byId("vsdFilterLabel").setText(s.filterString)},getViewSettingsDialog:function e(t){var n=this._mViewSettingsDialogs[t];if(!n){n=i.load({id:this.getView().getId(),name:t,controller:this}).then(function(e){if(s.system.desktop){e.addStyleClass("sapUiSizeCompact")}return e});this._mViewSettingsDialogs[t]=n}return n},updateURLParameters:function e(){const t=this.getView().byId("versionToSelect").getSelectedKey();const i=this.getView().byId("versionFromSelect").getSelectedKey();const s=new URLSearchParams(window.location.search);if(t){s.set("versionTo",t)}else{s.delete("versionTo")}if(i){s.set("versionFrom",i)}else{s.delete("versionFrom")}const n=`${window.location.origin}${window.location.pathname}?${s.toString()}${window.location.hash}`;window.history.replaceState({},"",n)}});return d});
//# sourceMappingURL=Whatsnew.controller.js.map